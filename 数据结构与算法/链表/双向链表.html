<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        // 封装双向链表
        function DoublyLinkedList(){
            // 内部类用于创建节点
            function Node(data){
                this.data=data;
                this.next=null;
                this.prev=null;
            }
            // 属性
            this.head=null;
            this.tail=null;
            this.length=0;

            // 链表的操作
            DoublyLinkedList.prototype.append=function(data){
                if(this.length==0){
                    var newNode=new Node(data);
                    this.head=newNode;
                    this.tail=newNode;
                }else{
                    var newNode=new Node(data);
                    newNode.prev=this.tail;
                    this.tail.next=newNode;
                    this.tail=newNode; // 改变尾指针的指向
                }
                this.length+=1;
            }
            DoublyLinkedList.prototype.toString=function(){
                return this.backwardString();
            }
            DoublyLinkedList.prototype.forwardString=function(){
                var current=this.tail;
                var resultString="";
                // 依次向前遍历
                while(current){
                    resultString+=current.data+" ";
                    current=current.prev;
                }
                return resultString;
            }
            DoublyLinkedList.prototype.backwardString=function(){
                var current=this.head;
                var resultString="";
                while(current){
                    resultString+=current.data+" ";
                    current=current.next;
                }
                return resultString;
            }
            DoublyLinkedList.prototype.insert=function(position,data){
                // 越界处理
                if(position<0||position>this.length){
                    return false;
                }
                // 创建新的节点
                var newNode=new Node(data);
                // 判断原来的链表是否为空
                if(this.length==0){
                    this.head=newNode;
                    this.tail=newNode;
                }else{
                    // 判断position是否为0
                    if(position==0){
                        // 原来第一个节点的前一个改变了
                        this.head.prev=newNode;
                        newNode.next=this.head;
                        this.head=newNode; // this.head可以更新了
                    }else if(position==this.length){
                        newNode.prev=this.tail;
                        this.tail.next=newNode;
                        this.tail=newNode;
                    }else{
                        var current=this.head;
                        var index=0;
                        while(index++<position){
                            current=current.next;
                        }
                        // 修改指针
                        newNode.next=current;
                        newNode.prev=current.prev;
                        current.prev.next=newNode;
                        current.prev=newNode;
                    }
                }
            }
            DoublyLinkedList.prototype.get=function(position){
                if(position<0||position>=this.length)
                    return null;
                var current=this.head;
                var index=0;
                while(index++<position){
                    current=current.next;
                }
                return current.data;
            }
            // 和单向链表很像
            DoublyLinkedList.prototype.indexOf=function(data){
                var current=this.head;
                var index=0;
                while(current){
                    if(current.data==data){
                        return index;
                    }
                    current=current.next;
                    index+=1;
                }       
                // 表示整个链表也没有找到
                return -1;
            }
            DoublyLinkedList.prototype.update=function(position,newData){
                // 越界判断
                if(position<0||position>=this.length){
                    return false;
                }
                var current=this.head;
                var index=0;
                while(index++<position){
                    current=current.next;
                }
                current.data=newData;
                return true;
            }
            // 根据位置删除
            DoublyLinkedList.prototype.removeAt=function(position){
                if(position<0||position>=this.length){
                    return null;
                }
                var current=this.head;
                // 逻辑判断
                // 判断是否只有一个节点
                if(this.length==1){
                    this.head=null;
                    this.tail=null;
                }else{
                    // 判断是否删除的是第一个节点
                    if(position==0){
                        this.head.next.prev=null;
                        this.head=this.head.next;
                    }else if(position==this.length-1){// 删除的是最后一个节点
                        current=this.tail; // 直接将current的指向改成尾指针即可
                        this.tail.prev.next=null;
                        this.tail=this.tail.prev;
                    }else{
                        var index=0;
                        while(index++<position){
                            current=current.next;
                        }
                        current.prev.next=current.next;
                        current.next.prev=current.prev;
                    }
                }
                // 长度-1
                this.length-=1;
                return current.data;
            }
        }

        var list=new DoublyLinkedList();
        list.append('abc');
        list.append("ooo");
        list.append("pappa");
        console.log(list);
        console.log(list.backwardString());
        list.insert(2,'ososo')
        console.log(list.backwardString());
        console.log(list.get(0));
        console.log(list.indexOf('abc'));
        console.log(list.removeAt(2));
    </script>
</body>
</html>