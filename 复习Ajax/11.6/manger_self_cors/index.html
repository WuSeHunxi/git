<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <!-- ie æŒ‰ç…§ æœ€æ–°çš„ æ–¹å¼æ¸²æŸ“ -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- è§†å£ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap 101 Template</title>

  <!-- Bootstrap -->
  <!--<link href="lib/css/bootstrap.min.css" rel="stylesheet">-->
  <!-- bootstrapçš„ æ ·å¼ -->
  <link href="lib/css/bootstrap.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!-- å…¼å®¹ ie9
    html5shiv html5çš„æ–°è¯­ä¹‰æ ‡ç­¾
    respond ä½ç‰ˆæœ¬çš„ieä¸­ ä¸æ”¯æŒ åª’ä½“æŸ¥è¯¢ @media
   -->
  <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
    h1 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .zombie-panel table th {
      text-align: center;
      background-color: #eee;
    }

    .zombie-panel table td {
      text-align: center;
    }
    /* æ¸…é™¤ åº•éƒ¨çš„æ ·å¼ */

    .zombie-panel .pagination {
      margin: 0;
    }

    .zombie-panel {
      position: relative;
    }

    #editModal .modal-dialog {
      position: relative;
    }

    #coverModal {
      background: url('img/loading.gif')no-repeat center;
    }

    a.disabled {
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <!-- æœ€å¤–å±‚çš„å®¹å™¨ -->
  <div class="container">
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <h1>äººå‘˜ç®¡ç†_è‡ªå·±çš„<small>--ç‰ˆæœ¬9.0</small></h1>
    <!-- é¢æ¿ -->
    <div class="zombie-panel panel panel-default">
      <!-- é¡¶éƒ¨ -->
      <div class="panel-heading">
        <h3 class="panel-title">ä¿¡æ¯åˆ—è¡¨</h3>
      </div>
      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="panel-body">
        <!-- è¡¨æ ¼ -->
        <table class="table table-bordered">
          <thead>
            <tr>
              <th width='10%'>åºå·</th>
              <th width='15%'>å§“å</th>
              <th width='15%'>å¹´é¾„</th>
              <th width='20%'>å­¦æ ¡</th>
              <th width='20%'>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <!--<tr>
              <td>1</td>
              <td>æ°´æ¡¶åƒµå°¸</td>
              <td>18</td>
              <td>zombie1</td>
              <td>åƒµå°¸å¤§å­¦</td>
              <td>
                <button class='btn btn-default btn-xs glyphicon glyphicon-remove'></button>
                <button class='btn btn-default btn-xs glyphicon glyphicon-edit'></button>
              </td>
            </tr>-->
          </tbody>
        </table>
      </div>
      <!-- åº•éƒ¨åŒºåŸŸ -->
      <div class="panel-footer">
        <nav class='clearfix' aria-label="Page navigation">
          <!-- åˆ†é¡µå™¨ -->
          <ul class="pagination pull-right">
            <li>
              <a href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li><a href="#">1</a></li>
            <li><a href="#">/</a></li>
            <li><a href="#">1</a></li>
            <li>
              <a href="javascript:void(0)" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
          <!-- æ–°å¢æŒ‰é’® -->
          <button data-toggle="modal" data-target="#addModal" class='btn btn-danger'>æ–°å¢</button>
        </nav>
      </div>
    </div>
  </div>

  <!-- æ–°å¢æ¨¡æ€æ¡† #addModal -->
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">æ–°å¢çª—å£</h4>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="addname">å§“å</label>
              <input type="text" name='name' class="form-control" id="addname" placeholder="è¯·è¾“å…¥çœŸå®å§“å">
            </div>
            <div class="form-group">
              <label for="addpassword">å¯†ç </label>
              <input type="password" name='password' class="form-control" id="addpassword" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
              <label for="addschool">å­¦æ ¡</label>
              <input type="text" class="form-control" name='school' id="addschool" placeholder="è¯·è¾“å…¥å­¦æ ¡">
            </div>
            <div class="form-group">
              <label for="addage">å¹´é¾„</label>
              <input type="text" name='age' class="form-control" id="addage" placeholder="è¯·è¾“å…¥å¹´é¾„">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">ä¿&nbsp;å­˜</button>
        </div>
      </div>
    </div>
  </div>
  <!-- ä¿®æ”¹æ¨¡æ€æ¡†æ¨¡æ€æ¡† #addModal -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">ä¿®æ”¹çª—å£</h4>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="editname">å§“å</label>
              <input type="text" name='name' class="form-control" id="editname" placeholder="è¯·è¾“å…¥çœŸå®å§“å">
            </div>
            <div class="form-group">
              <label for="editpassword">å¯†ç </label>
              <input type="password" name='password' class="form-control" id="editpassword" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
              <label for="editschool">å­¦æ ¡</label>
              <input type="text" class="form-control" name='school' id="editschool" placeholder="è¯·è¾“å…¥å­¦æ ¡">
            </div>
            <div class="form-group">
              <label for="editage">å¹´é¾„</label>
              <input type="text" name='age' class="form-control" id="editage" placeholder="è¯·è¾“å…¥å¹´é¾„">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>
  <!-- åˆ é™¤æ¨¡æ€æ¡† #removeModal -->
  <div class="modal fade" id="removeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">åˆ é™¤çª—å£</h4>
        </div>
        <div class="modal-body">
          <h2>ä½ çœŸçš„æƒ³æ¸…æ¥šäº†ï¼Œåˆ äº†å¯å°±æ²¡æœ‰äº†å“¦ğŸ˜</h2>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">æˆ‘æƒ³å¥½äº†</button>
        </div>
      </div>
    </div>
  </div>

  <!-- é®æŒ¡ç”¨ æ¨¡æ€æ¡†  -->
  <div class="modal fade" id="coverModal" tabindex="-1" role="dialog" data-backdrop='static' aria-labelledby="myModalLabel">
  </div>
</body>

</html>
<!--  jQ  -->
<script src="./lib/js/jquery-1.12.4.js"></script>
<!-- bsçš„js -->
<script src="./lib/js/bootstrap.min.js"></script>
<!-- æ¨¡æ¿å¼•æ“ -->
<script src="./lib/js/template-web.js"></script>
<!-- å®šä¹‰æ¨¡æ¿ -->
<script id='template' type="text/html">
  {{each list}}
  <tr>
    <td>{{$value.id}}</td>
    <td>{{$value.name}}</td>
    <td>{{$value.age}}</td>
    <td>{{$value.school}}</td>
    <td>
      <button data-toggle="modal" data-target="#removeModal" class="btn btn-default btn-xs glyphicon glyphicon-remove"></button>
      <button class="btn btn-default btn-xs glyphicon glyphicon-edit"></button>
    </td>
  </tr>
  {{/each}}
</script>
<!-- 
    å¯¼å…¥çš„æ–‡ä»¶
      jQ
      bootstrapçš„js
      æ¨¡æ¿å¼•æ“

    éœ€æ±‚ä»¬
      éœ€æ±‚1 é¡µé¢æ‰“å¼€è·å–æ•°æ® ç¬¬ä¸€é¡µ
          é¡µé¢domå…ƒç´ åˆ›å»ºå®Œæ¯• å…¥å£å‡½æ•°  jQuery
            å¼¹å‡ºé®ç½©å±‚ modal 
            æ— åˆ·æ–°è·å–æ•°æ®  ajax
              æ•°æ®è¯·æ±‚å›æ¥ä¹‹å  å›è°ƒå‡½æ•°
                å…³é—­é®ç½©å±‚ modal
                æ¸²æŸ“åˆ°é¡µé¢ä¸Š art-template - å¼•å…¥ - æŒ–å‘ - èµ·åå­— - å¡«å‘ - æ·»åŠ 
                è®¡ç®—æ€»é¡µæ•° æ ¹æ®è¿”å›çš„æ•°æ® è‡ªå·±è®¡ç®—
      éœ€æ±‚2 ç‚¹å‡»ä¸‹ä¸€é¡µ è·å–ä¸‹ä¸€é¡µçš„æ•°æ®
            å‡†å¤‡å˜é‡ è®°å½•é¡µç 
            ç‚¹å‡»çš„æ—¶å€™ ç¿»é¡µ
              åˆ¤æ–­æ˜¯å¦æœ‰disabled ç±»å æœ‰ 
                æç¤ºç”¨æˆ· 
                return
              é¡µç ++
              å¼¹å‡ºé®ç½©å±‚
              æ— åˆ·æ–°è·å–æ•°æ®
                æ•°æ®è¯·æ±‚å›æ¥ä¹‹å
                  å…³é—­é®ç½©å±‚
                  æ¸²æŸ“åˆ°é¡µé¢ä¸Š
                  ä¿®æ”¹å½“å‰é¡µ
                  å¦‚æœæ˜¯æœ€åä¸€é¡µ 
                    ç¦ç”¨ä¸‹ä¸€é¡µç‚¹å‡»
      éœ€æ±‚3 ç‚¹å‡»ä¸Šä¸€é¡µ è·å–ä¸Šä¸€é¡µçš„æ•°æ®
            å‡†å¤‡å˜é‡ è®°å½•é¡µç 
            ç‚¹å‡»çš„æ—¶å€™ ç¿»é¡µ
              åˆ¤æ–­æ˜¯å¦æœ‰disabled ç±»å æœ‰ 
                æç¤ºç”¨æˆ· 
                return
              é¡µç --
              å¼¹å‡ºé®ç½©å±‚
              æ— åˆ·æ–°è·å–æ•°æ®
                æ•°æ®è¯·æ±‚å›æ¥ä¹‹å
                  å…³é—­é®ç½©å±‚
                  æ¸²æŸ“åˆ°é¡µé¢ä¸Š
                  ä¿®æ”¹å½“å‰é¡µ
                  å¦‚æœæ˜¯ç¬¬ä¸€é¡µ 
                    ç¦ç”¨ä¸Šä¸€é¡µç‚¹å‡»
      éœ€æ±‚4 ç‚¹å‡»åˆ é™¤æŒ‰é’® åˆ é™¤è¿™ä¸€è¡Œ
          å˜é‡  åˆ é™¤id
          ç»‘å®šç»™ tbody ç‚¹å‡»äº‹ä»¶ è®©å†…éƒ¨çš„ åˆ é™¤æŒ‰é’®è§¦å‘
            è·å–ç‚¹å‡»çš„x å¯¹åº”çš„ åºå·å³å¯
            æŠŠè·å–åˆ°çš„id ä¿å­˜åˆ° å®šä¹‰çš„å˜é‡ä¸­
          ç»‘å®šç»™åˆ é™¤å¼¹æ¡†çš„ ç¡®è®¤æŒ‰é’®
            æ— åˆ·æ–°åˆ é™¤æ•°æ® è·Ÿä¸Šé¢çš„ç‚¹å‡»äº‹ä»¶å…±äº«ä¸€ä¸ª id
              ä½¿ç”¨å˜é‡ åˆ é™¤id è°ƒç”¨ åˆ é™¤æ¥å£å³å¯
                æ¥å£è°ƒç”¨æˆåŠŸ å›è°ƒå‡½æ•°è§¦å‘ä¹‹å 
      éœ€æ±‚5 ç‚¹å‡»æ–°å¢å¼¹æ¡†çš„ æ–°å¢æŒ‰é’® æ–°å¢æ•°æ®
            ç»‘å®šç‚¹å‡»äº‹ä»¶
              æ— åˆ·æ–° æ–°å¢æ•°æ® ajax
                è°ƒç”¨ jQueryçš„ æ ¼å¼åŒ–è¡¨å•çš„ä»£ç 
                æ•°æ®æ–°å¢æˆåŠŸä¹‹å
                  å†æ¬¡è·å– å½“å‰è¿™ä¸€é¡µçš„æ•°æ®
                    getData();
      éœ€æ±‚6 ç‚¹å‡»é¡µé¢ä¸­çš„ ç¼–è¾‘æ¡† è·å–å½“å‰è¿™ä¸€æ¡æ•°æ®
           ç»‘å®šç‚¹å‡»äº‹ä»¶ tbody æŒ‡å®š ç¼–è¾‘æŒ‰é’®è§¦å‘
           å¼¹å‡ºé®ç½©å±‚
           è·å–å½“å‰è¿™ä¸€è¡Œçš„id
              æ— åˆ·æ–° è·å–è¿™ä¸€è¡Œçš„æ•°æ® ajax
                  è¯·æ±‚å“åº”å›æ¥ä¹‹å
                    ä¿®æ”¹ä¿®æ”¹æ¡†æ¡†çš„å†…å®¹
                    å¼¹å‡ºä¿®æ”¹æ¡†æ¡†
      éœ€æ±‚7 ç‚¹å‡»ç¼–è¾‘æ¡†çš„ä¿å­˜æŒ‰é’® æäº¤æ•°æ®
            ç»‘å®šç‚¹å‡»äº‹ä»¶
              æ— åˆ·æ–°æäº¤æ•°æ®
                æ•°æ®æäº¤æˆåŠŸä¹‹å
                  é‡æ–°è·å–å½“å‰è¿™ä¸€é¡µçš„æ•°æ®
                    getData();


 -->
<script>
  // å®šä¹‰å˜é‡ è®°å½•é¡µç 
  var my_pageNum = 1;

  // è·å–æ•°æ®çš„å‡½æ•°
  function getData() {
    //  å¼€å¼¹æ¡†
    $('#coverModal').modal('show');
    // æ— åˆ·æ–°è·å–æ•°æ®
    $.ajax({
      url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/findUsers.php',
      data: {
        pageNum: my_pageNum,
        pageSize: 5
      },
      success: function (data) {
        console.log(data);
        // å…³å¼¹æ¡†
        $('#coverModal').modal('hide');
        // æ¸²æŸ“é¡µé¢
        $('tbody').html(template('template', data));
        // è®¡ç®—æ€»é¡µæ•°
        var totalPage = Math.ceil(data.total / data.pageSize)
        // è®¾ç½®æ€»é¡µæ•°
        $('.pagination li:eq(3) a').html(totalPage);
        // è®¾ç½®å½“å‰é¡µ
        $('.pagination li:eq(1) a').html(data.pageNum);
        // å¦‚æœæ˜¯æœ€åä¸€é¡µ
        if (data.pageNum == totalPage) {
          // æ·»åŠ ç¦ç”¨çš„ç±»
          $('a[aria-label="Next"]').addClass('disabled');
        } else {
          // å¦‚æœä¸æ˜¯æœ€åä¸€é¡µ
          $('a[aria-label="Next"]').removeClass('disabled');
        } // å¦‚æœæ˜¯ç¬¬ä¸€é¡µ
        if (data.pageNum == 1) {
          // æ·»åŠ ç¦ç”¨çš„ç±»
          $('a[aria-label="Previous"]').addClass('disabled');
        } else {
          // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µ
          $('a[aria-label="Previous"]').removeClass('disabled');

        }
      }
    })
  }

  // éœ€æ±‚1
  $(function () {
    // é»˜è®¤è·å–ä¸€æ¬¡æ•°æ®
    getData();

    // éœ€æ±‚2 ç‚¹å‡»ä¸‹ä¸€é¡µ
    $('a[aria-label="Next"]').click(function () {
      if ($(this).hasClass('disabled') == true) {
        alert('å“¥ä»¬,åˆ«ç‚¹äº†,åé¢æœ¨æœ‰äº†å“¦---O(âˆ©_âˆ©)Oå“ˆå“ˆ~');
        return;
      }
      // é¡µç ++
      my_pageNum++;
      // è·å–æ•°æ®
      getData();
    })

    // éœ€æ±‚3 ç‚¹å‡»ä¸Šä¸€é¡µ
    $('a[aria-label="Previous"]').click(function () {
      // åˆ¤æ–­æ˜¯å¦æœ‰ç±»å
      if ($(this).hasClass('disabled') == true) {
        alert('å“¥ä»¬,åˆ«ç‚¹äº†,å‰é¢æ²¡æœ‰äº†å“¦ ^_^');
        return;
      }
      // é¡µç --
      my_pageNum--;
      // è·å–æ•°æ®
      getData();
    })

    // éœ€æ±‚4-1 ä¸ºtbodyç»‘å®šç‚¹å‡»äº‹ä»¶ æŒ‡å®š åˆ é™¤æŒ‰é’®è§¦å‘
    var removeId;
    $('tbody').on('click', '.glyphicon-remove', function () {
      // è€çˆ¸ çš„ å…„å¼Ÿä»¬ çš„ ç¬¬ä¸€ä¸ª çš„å†…å®¹
      removeId = $(this).parent().siblings().first().html();
      // console.log(removeId);
    })

    // éœ€æ±‚4-2 ç‚¹å‡»ç¡®è®¤åˆ é™¤æŒ‰é’®
    $('#removeModal .btn-danger').click(function () {
      console.log('åˆ é™¤' + removeId);
      //  å¼€å¼¹æ¡†
      $('#coverModal').modal('show');
      // æ— åˆ·æ–°åˆ é™¤æ•°æ®
      $.ajax({
        url: "http://127.0.0.1/2017-8-18/00.API/api_cors/removeUser.php",
        type: 'post',
        data: {
          id: removeId
        },
        success: function (data) {
          // é‡æ–°è·å–å½“å‰é¡µæ•°æ®
          getData();
        }
      })
    })

    // éœ€æ±‚5 ç‚¹å‡»æ–°å¢æ•°æ®
    $('#addModal .btn-primary').click(function () {
      //  å¼€å¼¹æ¡†
      $('#coverModal').modal('show');
      console.log($("#addModal form").serialize());
      $.ajax({
        url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/saveUser.php',
        type: "post",
        //   $("#addModal form").serialize() æ ¼å¼åŒ–ä¹‹åçš„ç»“æœæ˜¯
        // key=value&key2=value2
        data: $("#addModal form").serialize(),
        success: function (data) {
          console.log(data);
          // è·å–æ•°æ®
          getData();
        }
      })
    })

    // éœ€æ±‚6
    // ç¼–è¾‘id
    var editId;
    $('tbody').on('click', '.glyphicon-edit', function () {
      //  å¼€å¼¹æ¡†
      $('#coverModal').modal('show');
      // è‡ªå·±çš„ çˆ¶äº²çš„ å…„å¼Ÿ ç¬¬ä¸€ä¸ª å†…å®¹
      editId = $(this).parent().siblings().first().html();
      console.log(editId);
      // è·å–å¯¹åº”çš„æ•°æ®
      $.ajax({
        url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/getOneUser.php',
        data: {
          id: editId
        },
        success: function (data) {
          console.log(data);
          //  å…³å¼¹æ¡†
          $('#coverModal').modal('hide');
          // ä¿®æ”¹å¼¹æ¡†ä¸­çš„ å†…å®¹
          $('#editModal form input[name=name]').val(data.list[0].name);
          $('#editModal form input[name=age]').val(data.list[0].age);
          $('#editModal form input[name=school]').val(data.list[0].school);
          $('#editModal form input[name=password]').val(data.list[0].password);
          // å¼¹æ¡†
          $("#editModal").modal('show');
        }
      })
    })

    // éœ€æ±‚7 ä¿å­˜æ•°æ®
    $('#editModal .btn-primary').click(function () {
      //  å¼€å¼¹æ¡†
      $('#coverModal').modal('show');
      // æ ¼å¼åŒ–è¡¨å•
      var sendData = $('#editModal form').serialize();
      // key1=value1&key2=value2&id=editId;
      sendData += '&id=';
      sendData += editId;
      // console.log(sendData);
      $.ajax({
        url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/modifyUser.php',
        data: sendData,
        type: 'post',
        success: function (data) {
          console.log(data);
          getData();
        }
      })
    })
  })
</script>