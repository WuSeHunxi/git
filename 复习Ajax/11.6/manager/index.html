<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <!-- ie æŒ‰ç…§ æœ€æ–°çš„ æ–¹å¼æ¸²æŸ“ -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- è§†å£ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap 101 Template</title>

  <!-- Bootstrap -->
  <!--<link href="lib/css/bootstrap.min.css" rel="stylesheet">-->
  <!-- bootstrapçš„ æ ·å¼ -->
  <link href="lib/css/bootstrap.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!-- å…¼å®¹ ie9
    html5shiv html5çš„æ–°è¯­ä¹‰æ ‡ç­¾
    respond ä½ç‰ˆæœ¬çš„ieä¸­ ä¸æ”¯æŒ åª’ä½“æŸ¥è¯¢ @media
   -->
  <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
    h1 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .zombie-panel table th {
      text-align: center;
      background-color: #eee;
    }

    .zombie-panel table td {
      text-align: center;
    }
    /* æ¸…é™¤ åº•éƒ¨çš„æ ·å¼ */

    .zombie-panel .pagination {
      margin: 0;
    }

    .zombie-panel {
      position: relative;
    }

    #editModal .modal-dialog {
      position: relative;
    }

    #coverModal {
      background: url('img/loading.gif')no-repeat center;
    }

    a.disabled {
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <!-- æœ€å¤–å±‚çš„å®¹å™¨ -->
  <div class="container">
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <h1>äººå‘˜ç®¡ç†_coding<small>--ç‰ˆæœ¬1.0</small></h1>
    <!-- é¢æ¿ -->
    <div class="zombie-panel panel panel-default">
      <!-- é¡¶éƒ¨ -->
      <div class="panel-heading">
        <h3 class="panel-title">ä¿¡æ¯åˆ—è¡¨</h3>
      </div>
      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="panel-body">
        <!-- è¡¨æ ¼ -->
        <table class="table table-bordered">
          <thead>
            <tr>
              <th width='10%'>åºå·</th>
              <th width='15%'>å§“å</th>
              <th width='15%'>å¹´é¾„</th>
              <th width='20%'>å­¦æ ¡</th>
              <th width='20%'>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <!--<tr>
              <td>1</td>
              <td>æ°´æ¡¶åƒµå°¸</td>
              <td>18</td>
              <td>zombie1</td>
              <td>åƒµå°¸å¤§å­¦</td>
              <td>
                <button class='btn btn-default btn-xs glyphicon glyphicon-remove'></button>
                <button class='btn btn-default btn-xs glyphicon glyphicon-edit'></button>
              </td>
            </tr>-->
          </tbody>
        </table>
      </div>
      <!-- åº•éƒ¨åŒºåŸŸ -->
      <div class="panel-footer">
        <nav class='clearfix' aria-label="Page navigation">
          <!-- åˆ†é¡µå™¨ -->
          <ul class="pagination pull-right">
            <li>
              <a href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li><a href="#">1</a></li>
            <li><a href="#">/</a></li>
            <li><a href="#">1</a></li>
            <li>
              <a href="javascript:void(0)" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
          <!-- æ–°å¢æŒ‰é’® -->
          <button data-toggle="modal" data-target="#addModal" class='btn btn-danger'>æ–°å¢</button>
        </nav>
      </div>
    </div>
  </div>

  <!-- æ–°å¢æ¨¡æ€æ¡† #addModal -->
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">æ–°å¢çª—å£</h4>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="addname">å§“å</label>
              <input type="text" name='name' class="form-control" id="addname" placeholder="è¯·è¾“å…¥çœŸå®å§“å">
            </div>
            <div class="form-group">
              <label for="addpassword">å¯†ç </label>
              <input type="password" name='password' class="form-control" id="addpassword" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
              <label for="addschool">å­¦æ ¡</label>
              <input type="text" class="form-control" name='school' id="addschool" placeholder="è¯·è¾“å…¥å­¦æ ¡">
            </div>
            <div class="form-group">
              <label for="addage">å¹´é¾„</label>
              <input type="text" name='age' class="form-control" id="addage" placeholder="è¯·è¾“å…¥å¹´é¾„">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">ä¿&nbsp;å­˜</button>
        </div>
      </div>
    </div>
  </div>
  <!-- ä¿®æ”¹æ¨¡æ€æ¡†æ¨¡æ€æ¡† #addModal -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">ä¿®æ”¹çª—å£</h4>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="editname">å§“å</label>
              <input type="text" name='name' class="form-control" id="editname" placeholder="è¯·è¾“å…¥çœŸå®å§“å">
            </div>
            <div class="form-group">
              <label for="editpassword">å¯†ç </label>
              <input type="password" name='password' class="form-control" id="editpassword" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
              <label for="editschool">å­¦æ ¡</label>
              <input type="text" class="form-control" name='school' id="editschool" placeholder="è¯·è¾“å…¥å­¦æ ¡">
            </div>
            <div class="form-group">
              <label for="editage">å¹´é¾„</label>
              <input type="text" name='age' class="form-control" id="editage" placeholder="è¯·è¾“å…¥å¹´é¾„">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>
  <!-- åˆ é™¤æ¨¡æ€æ¡† #removeModal -->
  <div class="modal fade" id="removeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">åˆ é™¤çª—å£</h4>
        </div>
        <div class="modal-body">
          <h2>ä½ çœŸçš„æƒ³æ¸…æ¥šäº†ï¼Œåˆ äº†å¯å°±æ²¡æœ‰äº†å“¦ğŸ˜</h2>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">æˆ‘æƒ³å¥½äº†</button>
        </div>
      </div>
    </div>
  </div>

  <!-- é®æŒ¡ç”¨ æ¨¡æ€æ¡†  -->
  <div class="modal fade" id="coverModal" tabindex="-1" role="dialog" data-backdrop='static' aria-labelledby="myModalLabel">
  </div>
</body>

</html>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="lib/js/jquery-1.12.4.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="lib/js/bootstrap.min.js"></script>

<!-- å¯¼å…¥æ¨¡æ¿å¼•æ“ -->
<script src="./lib/js/template-web.js"></script>
<!-- å®šä¹‰æ¨¡æ¿  -->
<script type='text/html' id='template'>
  {{each list}}
  <tr>
    <td>{{$value.id}}</td>
    <td>{{$value.name}}</td>
    <td>{{$value.age}}</td>
    <td>{{$value.school}}</td>
    <td>
      <button data-toggle="modal" data-target="#removeModal" class="btn btn-default btn-xs glyphicon glyphicon-remove"></button>
      <button class="btn btn-default btn-xs glyphicon glyphicon-edit"></button>
    </td>
  </tr>
  {{/each}}
</script>
<!-- 
  éœ€æ±‚
    éœ€æ±‚1
      é¡µé¢æ‰“å¼€
        æ— åˆ·æ–°åŠ è½½ ç¬¬ä¸€é¡µ æ•°æ®
          å…ˆå¼¹å‡ºé®ç½©å±‚
            æ•°æ®åŠ è½½å›æ¥ä¹‹å
              å…³é—­é®ç½©å±‚
              æ¸²æŸ“åˆ°é¡µé¢ä¸Š
              ä¿®æ”¹é¡µç æ˜¾ç¤º
              åˆ¤æ–­æ˜¯å¦ä¸ºæœ€åä¸€é¡µ
                å¦‚æœæ˜¯,ç¦ç”¨ä¸‹ä¸€é¡µ
                åä¹‹,å¯ç”¨ä¸‹ä¸€é¡µ
    éœ€æ±‚2 
       ç‚¹å‡»ä¸‹ä¸€é¡µæŒ‰é’®
        æ— åˆ·æ–°è·å–ä¸‹ä¸€é¡µæ•°æ®
          å…ˆå¼¹å‡ºé®ç½©å±‚
            æ•°æ®åŠ è½½å›æ¥ä¹‹å
              å…³é—­é®ç½©å±‚
              æ¸²æŸ“åˆ°é¡µé¢ä¸Š
              ä¿®æ”¹é¡µç æ˜¾ç¤º
              åˆ¤æ–­æ˜¯å¦ä¸ºæœ€åä¸€é¡µ
                å¦‚æœæ˜¯,ç¦ç”¨ä¸‹ä¸€é¡µ
                åä¹‹,å¯ç”¨ä¸‹ä¸€é¡µ
    éœ€æ±‚3 
       ç‚¹å‡»ä¸Šä¸€é¡µæŒ‰é’®
        æ— åˆ·æ–°è·å–ä¸Šä¸€é¡µæ•°æ®
          å…ˆå¼¹å‡ºé®ç½©å±‚
            æ•°æ®åŠ è½½å›æ¥ä¹‹å
              å…³é—­é®ç½©å±‚
              æ¸²æŸ“åˆ°é¡µé¢ä¸Š
              åˆ¤æ–­æ˜¯å¦ä¸ºç¬¬ä¸€é¡µ
                å¦‚æœæ˜¯,ç¦ç”¨ä¸Šä¸€é¡µ
                åä¹‹,å¯ç”¨ä¸Šä¸€é¡µ
    éœ€æ±‚4
       ç‚¹å‡»æ–°å¢çª—å£ä¸­çš„æ–°å¢æŒ‰é’®
        æ— åˆ·æ–°æ·»åŠ æ•°æ®
          å…ˆå¼¹å‡ºé®ç½©å±‚
            æ·»åŠ æˆåŠŸä¹‹å
              å…³é—­é®ç½©å±‚
              æ¸²æŸ“åˆ°é¡µé¢ä¸Š
              åˆ¤æ–­æ˜¯å¦ä¸ºç¬¬ä¸€é¡µ
                å¦‚æœæ˜¯,ç¦ç”¨ä¸Šä¸€é¡µ
                åä¹‹,å¯ç”¨ä¸Šä¸€é¡µ
 -->
<script>
  // å®šä¹‰é¡µç 
  var my_pageNum = 1;
  // è·å–æ•°æ®å‡½æ•°
  function getData() {
    // éœ€æ±‚1
    // $('#coverModal').modal('show');
    $.ajax({
      url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/findUsers.php',
      data: {
        pageNum: my_pageNum,
        pageSize: 6
      },
      success: function (data) {
        console.log(data);
        // å…³é—­é®ç½©å±‚
        // $('#coverModal').modal('hide');
        // æ¸²æŸ“æ•°æ®
        $('tbody').html(template('template', data));
        // ä¿®æ”¹é¡µç 
        // è®¡ç®—æ€»é¡µç 
        var totalPage = Math.ceil(data.total / data.pageSize);
        // è®¾ç½®ç»™æ€»é¡µæ•°
        $('.pagination li:eq(1) a').html(data.pageNum);
        // è®¾ç½®ç»™å½“å‰é¡µ
        $('.pagination li:eq(3) a').html(totalPage);
        // å¯ç”¨ ç¦ç”¨ ä¸‹ä¸€é¡µ
        if (data.pageNum == totalPage) {
          $('a[aria-label="Next"]').addClass('disabled')
        } else {
          $('a[aria-label="Next"]').removeClass('disabled')
        }
        // å¯ç”¨ ç¦ç”¨ ä¸Šä¸€é¡µ
        if (data.pageNum == 1) {
          $('a[aria-label="Previous"]').addClass('disabled')
        } else {
          $('a[aria-label="Previous"]').removeClass('disabled')
        }
      }
    })
  }
  $(document).ajaxStart(function(){
    $('#coverModal').modal('show');
  })
  $(document).ajaxComplete(function(){
    $('#coverModal').modal('hide');
  })
  // å…¥å£å‡½æ•°
  $(function () {

    // é¡µé¢æ‰“å¼€ é»˜è®¤è·å–æ•°æ®
    getData();

    // ä¸‹ä¸€é¡µ
    $('a[aria-label="Next"]').click(function () {
      if ($(this).hasClass('disabled')) {
        alert('åé¢æœ¨æœ‰äº†,åˆ«ç‚¹äº†');
        return;
      }
      my_pageNum++;
      getData();
    })
    // ä¸Šä¸€é¡µ
    $('a[aria-label="Previous"]').click(function () {
      if ($(this).hasClass('disabled')) {
        alert('å‰é¢æœ¨æœ‰äº†,åˆ«ç‚¹äº†');
        return;
      }
      my_pageNum--;
      getData();
    })

    // ç‚¹å‡»æ–°å¢
    $('#addModal .btn-primary').click(function () {
      // å¼€å¯é®ç½©å±‚
      $('#coverModal').modal('show');
      $.ajax({
        url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/saveUser.php',
        type: 'post',
        data: $("#addModal form").serialize(),
        success: function (data) {
          console.log(data);
          getData();
        }
      })
    })

    // ç‚¹å‡»åˆ é™¤
    var removeId;
    $('tbody').on('click', '.glyphicon-remove', function () {
      removeId = $(this).parent().siblings().first().html();
      console.log(removeId);
    })
    // ç‚¹å‡»åˆ é™¤çª—çš„ç¡®è®¤æŒ‰é’®
    $('#removeModal .btn-danger').click(function () {
      // console.log(123);
      $('#coverModal').modal('show');
      $.ajax({
        url: "http://127.0.0.1/2017-8-18/00.API/api_cors/removeUser.php",
        type: 'post',
        data: {
          id: removeId
        },
        success: function (data) {
          console.log(data);
          getData();
        }
      })
    })

    // ç‚¹å‡»ä¿®æ”¹
    var editId;
    $('tbody').on('click', '.glyphicon-edit', function () {
      editId = $(this).parent().siblings().first().html();
      // è·å–å½“å‰çš„æ•°æ®
      $.ajax({
        url: 'http://127.0.0.1/2017-8-18/00.API/api_cors/getOneUser.php',
        data: {
          id: editId
        },
        success: function (data) {
          console.log(data);
          $('#editModal').find('input[name=name]').val(data.list[0].name)
          $('#editModal').find('input[name=password]').val(data.list[0].password)
          $('#editModal').find('input[name=school]').val(data.list[0].school)
          $('#editModal').find('input[name=age]').val(data.list[0].age)
          $("#editModal").modal('show');
        }
      })
    })
    // ç‚¹å‡»ä¿®æ”¹çª—çš„ç¡®è®¤æŒ‰é’®
    $('#editModal .btn-primary').click(function () {
      $.ajax({
        url: "http://127.0.0.1/2017-8-18/00.API/api_cors/modifyUser.php",
        type: 'post',
        data: ($('#editModal form').serialize()+'&id='+editId),
        success: function (data) {
          getData();
        }
      })
    })


  })
</script>